apiVersion: v1
kind: Pod
metadata:
  name: tailscale-sidecar
spec:
  serviceAccountName: tailscale
  containers:
  - name: ubuntu
    image: ubuntu
    command: ["/bin/bash", "-c", "--"]
    args:
    - "while true; do sleep 30; done"
  - imagePullPolicy: Always
    name: tailscale
    image: "{{IMAGE_TAG}}"
    env:
      # Store the state in a k8s secret
    - name: KUBE_SECRET
      value: "tailscale"
    - name: USERSPACE
      value: "false"
    - name: AUTH_KEY
      valueFrom:
        secretKeyRef:
          name: tailscale-auth
          key: AUTH_KEY
          optional: true
    securityContext:
      capabilities:
        add:
        - NET_ADMIN
